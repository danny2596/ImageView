<style>
	.pic-filter{
		width: 100%;
		text-align: center;
		background: black;
		overflow: hidden;
	}
	.pic-load-img{
		height: 100%;
	}
	.alpha{
		display: inline-block;
		font-size: 12px;
		color: red;
		border-style: dashed;
		border-color: red;
		border-width: 1px;
		margin-left: 2px;
	}
	.subdir{
		display: inline-block;
		font-size: 12px;
		color: rgb(245, 78, 0);
		border-style: dashed;
		border-color: rgb(245, 78, 0);
		border-width: 1px;
		margin-left: 2px;
	}
	.non-img{
		display: inline-block;
		font-size: 12px;
		color: rgb(209, 0, 209);
		border-style: dashed;
		border-color: rgb(209, 0, 209);
		border-width: 1px;
		margin-left: 2px;
	}
	.bookinfo{
		display: inline-block;
		font-size: 12px;
		padding-left: 5px;
	}
</style>
<div class='pic-filter' id="pic-filter">
	<img src="file://C:/Users/Danny/Documents/Test File/新增資料夾/Cover.jpg" alt="" class='pic-load-img' >
</div>
<script>
	var currBook;
	var startTime=0;
	var filterH,filterW;
	var openMode=0;//openMode: 0=>Open Root dir or book; 1=>move target 1; 2=>move target 2; 3=>move target 3;
	var moveTarget=[];
	function onInit(){
		onWindowResize();
	}
	function dirOpened(obj){
		if(obj === undefined){
			if( typeof(gDir) === 'undefined' )
				return;
			else
				dir=gDir;
		}else{
			dir=obj;
		}
		if(openMode===0)
			openRootDir(dir);
		else
			openMoveTarget(dir,openMode);

		openMode=0;
	}
	function onWindowResize(){
		pd(I,"@pic.html >> onWindowResize Start");
		let winH= window.innerHeight;
		let winW= window.innerWidth;
		filterH = winH-30;
		filterW=winW;
		$('.pic-filter').css('height',filterH);
		showImg();
		pd(I,"@pic.html >> onWindowResize end");
	}
	function onDestroy(){

	}
	function openRootDir(obj){
		let dir=obj;
		pd("i","@pic.html > openRootDir start");
		
		pd(I,"@pic.html > openRootDir > open book, root dirArr.length="+dir.dirArr.length+", fileArr.length="+dir.fileArr.length);

		try{
			if(dir.dirArr.length>0 && dir.fileArr.length===0){
				let bookPath=dir.dirPath+"\\"+dir.dirArr[0];
				dir.currDir=0;
				let book = readDir(bookPath);
				openBook(book);
			}else if(dir.fileArr.length>0){
				//get parent dir
				let parentPath = getParentPath(dir.dirPath);
				if(parentPath==null)
					return;
				//set up gDir
				gDir = readDir(parentPath);
				let idx = gDir.dirArr.indexOf(getName(dir.dirPath));
				gDir.currDir=idx;
				//openBook
				openBook(dir);
			}
		}catch(e){
			pd('e',"@pic.html > openRootDir > open book ERROR : "+e.message);
		}
	}
	function openBook(dir){
		let msg = "";
		currBook=dir;
		//1. check is nature sort
		let tmp = dir.fileArr.slice(0);
		tmp.sort();
		if(stringArrayCmp(tmp,dir.fileArr)){
			pd(I,"@pic.html >> open book; equals");
		}
		else{
			msg += "<div class='alpha'>Alpha</div>";
			pd(I,"@pic.html >> open book; not equals");
		}
		//2. check has dir insite
		if(dir.dirArr.length>0){
			msg+="<div class='subdir'>SubDIR</div>";
		}
		//3. remove non-image file
		let imgOnly=[];
		let hasNonImg=false;
		for(let i=0;i<dir.fileArr.length;i++){
			let fname=dir.fileArr[i];
			if(isImage(fname)){
				imgOnly.push(fname);
			}else{
				hasNonImg=true;
			}
		}
		dir.fileArr=imgOnly;
		if(hasNonImg){
			msg+="<div class='non-img'>NonImg</dev>";
		}
		//4. put book info
		if(dir.fileArr.length===0){
			msg+='<div class="bookinfo" id="book-info">NO IMAGE CAN SHOW</div>';
		}
		else{
			let bookName=getName(dir.dirPath);
			currBook.bookName=bookName;
			msg+='<div class="bookinfo" id="book-info">'+bookName+' [1/'+dir.fileArr.length+']</div>';
			msg+='<div class="bookinfo" id="uTime"></div>'
		}
		
		//5. show info message
		let info = $('#info');
		info.empty();
		info.append(msg);

		//6.show image
		currBook.currFile=0;
		if(currBook.fileArr.length>0)
			showImg();
	}
	function showImg(){
		pd(I,"@pic.html >> showImg, start");
		if(startTime!==0){
			pd(I,"@pic.html >> showImg, startTime="+startTime+", return");
			return;
		}

		if(typeof(currBook)==='undefined' || typeof(currBook.currFile) === 'undefined')
			return;
		startTime = new Date().getTime();
		$('#pic-filter').empty();
		pd(I,"@pic.html >> showImg, empty");
		let imgPath;
		if(currBook.dirPath[currBook.dirPath.length-1]==='\\'){
			imgPath=currBook.dirPath+currBook.fileArr[currBook.currFile];
		}else{
			imgPath=currBook.dirPath+'\\'+currBook.fileArr[currBook.currFile];
		}
		pd(I,"@pic.html >> showImg, img path="+imgPath);
		let imgstr="<img src='"+winPath2FileURL(imgPath)+"'>";

		let img=$(imgstr);
		pd(I,"@pic.html >> showImg, create img elem");
		img.css('display','none');
		img.load(function(event){
			let uTime = new Date().getTime() - startTime;
			if(startTime !==0){
				pd(I,"@pic.html >> showImg, img on load usage time = "+uTime+" ms");
			}else{
				pd(I,"@pic.html >> showImg, img on load ,startTime=0 something error");
			}
			let imgH = this.naturalHeight;
			let imgW = this.naturalWidth;
			let elem=$(this);
			pd(I,"@pic.html >> showImg, get elem, W="+imgW+", H="+imgH);
			let tmp =filterW-(imgW*(filterH/imgH));
			if(tmp>0){
				elem.css('height','100%');
			}else{
				elem.css('width','100%');
			}
			elem.css('display','initial');
			$('#uTime').text(uTime+'ms');
			startTime=0;
		});
		$('#pic-filter').append(img);

	}
	function prevBook(){
		pd(I,"@pic.html > preBook start");
	}
	function nextBook(){
		pd(I,"@pic.html > nextBook start");
	}
	function prevPage(){
		pd(I,"@pic.html > prevPage start");
		if(typeof(currBook)==='undefined' || typeof(currBook.currFile) === 'undefined')
			return;
		currBook.currFile--;
		if(currBook.currFile === -1){
			currBook.currFile++;
			pd(I,"@pic.html > prevPage; no prev Page");

			return;
		}
		$('#book-info').text(currBook.bookName+' ['+(currBook.currFile+1)+'/'+currBook.fileArr.length+']');
		showImg();


	}
	function nextPage(){
		pd(I,"@pic.html > nextPage start");
		if(typeof(currBook)==='undefined' || typeof(currBook.currFile) === 'undefined')
			return;
		currBook.currFile++;
		if(currBook.currFile === currBook.fileArr.length){
			currBook.currFile--;
			pd(I,"@pic.html > nextPage; no next Page");

			return;
		}
		$('#book-info').text(currBook.bookName+' ['+(currBook.currFile+1)+'/'+currBook.fileArr.length+']');
		showImg();
	}
	function firstPage(){
		pd(I,"@pic.html > firstPage start");
		if(typeof(currBook)==='undefined' || typeof(currBook.currFile) === 'undefined')
			return;
	}
	function lastPage(){
		pd(I,"@pic.html > lastPage start");
		if(typeof(currBook)==='undefined' || typeof(currBook.currFile) === 'undefined')
			return;
	}
	function deletePage(){
		
	}
	function moveBook(target){
		//copy src path and name
		
		//remove name form gDir.dirArr
		
		//check currDir is out of range or not
		
		//open book
		
		//use fs rename to target
	}
	function onKeydownEvent(key){
		
		switch(key){
			case 38:
				//up
				prevPage();
				break;
			case 40:
				//down
				nextPage();
				break;
			case 37:
				//left
				break;
			case 39:
				//right
				break;
			case 219:
				//[
				prevBook();
				break;
			case 221:
				//]
				nextBook();
				break;
			case 33:
				//page up
				prevPage();
				break;
			case 34:
				//page down
				nextPage();
				break;
			case 35:
				//end
				lastPage();
				break;
			case 36:
				//home
				firstPage();
				break;
			case 46:
				//delete
				break;
			case 49:
				//1
				break;
			case 50:
				//2
				break;
			case 51:
				//3
				break;
			case 81:
				//q
				break;
			case 87:
				//w
				break;
			case 69:
				//e
				break;	
		}
	}//end of onKeydownEvent

	function openMoveTarget(dir,mode){

	}
</script>